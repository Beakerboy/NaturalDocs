<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ReferenceChangeCache</title><link rel="stylesheet" type="text/css" href="../../../../../../styles/main.css" /><script type="text/javascript" src="../../../../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Topic29"></a><div class="CTopic TClass LCSharp first">
 <div class="CTitle"><span class="Qualifier">CodeClear.&#8203;NaturalDocs.&#8203;Engine.&#8203;CodeDB.</span>&#8203;ReferenceChangeCache</div>
 <div class="NDClassPrototype HasParents" id="NDClassPrototype29"><div class="CPEntry Parent TClass"><div class="CPName">List&#8203;<span class="TemplateSignature">&lt;ReferenceChangeEntry&gt;</span></div></div><div class="CPEntry TClass Current"><div class="CPModifiers"><span class="SHKeyword">public</span></div><div class="CPName"><span class="Qualifier">CodeClear.&#8203;NaturalDocs.&#8203;Engine.&#8203;CodeDB.</span>&#8203;ReferenceChangeCache</div></div></div>
 <div class="CBody"><p>A class that stores changes to reference counts in memory so they don't have to hit the database on every operation.</p><p>This class ignores all operations on ID zero.</p><div class="CHeading">Usage</div><ul><li><p>Create the cache.</p></li><li><p>Every time a reference is added or deleted, call <a href="../../../../../../index.html#CSharpClass:CodeClear.NaturalDocs.Engine.CodeDB.ReferenceChangeCache:AddReference" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,32);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >AddReference()</a> or <a href="../../../../../../index.html#CSharpClass:CodeClear.NaturalDocs.Engine.CodeDB.ReferenceChangeCache:RemoveReference" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,33);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >RemoveReference()</a>.</p></li><li><p>If you know the reference count stored in the database for an object that's likely to change, add it to the cached information with <a href="../../../../../../index.html#CSharpClass:CodeClear.NaturalDocs.Engine.CodeDB.ReferenceChangeCache:SetDatabaseReferenceCount" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,34);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >SetDatabaseReferenceCount()</a>.&nbsp; This will lessen the database work when the cache is flushed, but don't do this for references that might not change or you'll just be filling up memory with unnecessary cache entries.</p></li><li><p>When it's time to flush the cache...</p><ul><li><p>Use foreach to iterate through the <a href="../../../../../../index.html#CSharpClass:CodeClear.NaturalDocs.Engine.CodeDB.ReferenceChangeEntry" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,37);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >ReferenceChangeEntries</a>.</p></li><li><p>Find the database reference count for any entries where it's unknown.</p></li><li><p>Update the database.&nbsp; Delete any records where the total reference count is now zero, and update any other records where the count has changed.</p></li></ul></li></ul></div>
</div>

<a name="Functions"></a><a name="Topic30"></a><div class="CTopic TGroup LCSharp">
 <div class="CTitle">Functions</div>
</div>

<a name="ReferenceChangeCache"></a><a name="Topic31"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">ReferenceChangeCache</div>
 <div id="NDPrototype31" class="NDPrototype NoParameterForm"><span class="SHKeyword">public</span> ReferenceChangeCache()</div>
</div>

<a name="AddReference"></a><a name="Topic32"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">AddReference</div>
 <div id="NDPrototype32" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">void</span> AddReference (</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">objectID</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Increases the reference count of the passed object ID.&nbsp; This is ignored if the ID is zero.</p></div>
</div>

<a name="RemoveReference"></a><a name="Topic33"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">RemoveReference</div>
 <div id="NDPrototype33" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">void</span> RemoveReference (</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">objectID</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Decreases the reference count of the passed object ID.&nbsp; This is ignored if the ID is zero.</p></div>
</div>

<a name="SetDatabaseReferenceCount"></a><a name="Topic34"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">SetDatabaseReferenceCount</div>
 <div id="NDPrototype34" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <span class="SHKeyword">void</span> SetDatabaseReferenceCount (</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">objectID,</td></tr><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">databaseReferences</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Sets the number of references the passed object ID has according to the database.&nbsp; This is before any changes stored in this cache are applied.</p><p>This is primarily used to fill in the existing entries before flushing the cache.&nbsp; However, you can also use this to fill in known data before that point to avoid a trip to the database later.&nbsp; It's recommended that you only do this for entries that are likely to change so you don't balloon the cache with unnecessary data.</p></div>
</div>

<a name="ChangesFor"></a><a name="Topic35"></a><div class="CTopic TFunction LCSharp">
 <div class="CTitle">ChangesFor</div>
 <div id="NDPrototype35" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">public</span> <a href="../../../../../../index.html#CSharpClass:CodeClear.NaturalDocs.Engine.CodeDB.ReferenceChangeEntry" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,37);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >ReferenceChangeEntry</a> ChangesFor (</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">id</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Returns the <a href="../../../../../../index.html#CSharpClass:CodeClear.NaturalDocs.Engine.CodeDB.ReferenceChangeEntry" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,37);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >ReferenceChangeEntry</a> for the passed ID, or null if there is none.</p></div>
</div>

<a name="BinarySearch"></a><a name="Topic36"></a><div class="CTopic TFunction LCSharp last">
 <div class="CTitle">BinarySearch</div>
 <div id="NDPrototype36" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">protected</span> <span class="SHKeyword">int</span> BinarySearch (</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">objectID</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Searches the list for the passed object ID.&nbsp; If it finds it, the return value will be zero or positive representing the index of the item.&nbsp; If it doesn't, the return value will be the bitwise complement of the index the item should be inserted at.&nbsp; This is consistent with the system used by System.Collections.Generic.List.BinarySearch().</p><p>Why not just use the system function with a custom comparer?&nbsp; Because it only looks up items by object, which means every time you would want to look up an item by its ID you would need to allocate a temporary object, which is ridiculously inefficient.</p><p>Why not just use System.Collections.Generic.SortedList?&nbsp; Because then other code would have to iterate through using Pairs to get the ID and other data.&nbsp; That's a little more awkward and it exposes too much implementation.</p></div>
</div>

</body></html>